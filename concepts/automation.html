<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The Automation API - The Synthizer Manual</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../python.html"><strong aria-hidden="true">2.</strong> Where are the Python Bindings?</a></li><li class="chapter-item expanded affix "><li class="part-title">Concepts</li><li class="chapter-item expanded "><a href="../concepts/c_api.html"><strong aria-hidden="true">3.</strong> Introduction to the C API</a></li><li class="chapter-item expanded "><a href="../concepts/initialization.html"><strong aria-hidden="true">4.</strong> Logging, Initialization, and Shutdown</a></li><li class="chapter-item expanded "><a href="../concepts/handles.html"><strong aria-hidden="true">5.</strong> Handles and userdata</a></li><li class="chapter-item expanded "><a href="../concepts/audio_in.html"><strong aria-hidden="true">6.</strong> Basics of Audio In Synthizer</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../concepts/context.html"><strong aria-hidden="true">6.1.</strong> The Context</a></li><li class="chapter-item expanded "><a href="../concepts/generators.html"><strong aria-hidden="true">6.2.</strong> Introduction to Generators</a></li><li class="chapter-item expanded "><a href="../concepts/sources.html"><strong aria-hidden="true">6.3.</strong> Introduction to Sources</a></li><li class="chapter-item expanded "><a href="../concepts/properties.html"><strong aria-hidden="true">6.4.</strong> Controlling Object Properties</a></li><li class="chapter-item expanded "><a href="../concepts/gain.html"><strong aria-hidden="true">6.5.</strong> Setting Gain/volume</a></li><li class="chapter-item expanded "><a href="../concepts/pausing.html"><strong aria-hidden="true">6.6.</strong> Pausing and Resuming Playback</a></li><li class="chapter-item expanded "><a href="../concepts/lingering.html"><strong aria-hidden="true">6.7.</strong> Configuring Objects to Continue Playing Until Silent</a></li><li class="chapter-item expanded "><a href="../concepts/decoding.html"><strong aria-hidden="true">6.8.</strong> Streams and Decoding Audio Data</a></li><li class="chapter-item expanded "><a href="../concepts/libsndfile.html"><strong aria-hidden="true">6.9.</strong> Loading Libsndfile</a></li><li class="chapter-item expanded "><a href="../concepts/custom_streams.html"><strong aria-hidden="true">6.10.</strong> Implementing Custom Streams and Custom Stream Protocols</a></li><li class="chapter-item expanded "><a href="../concepts/channel_mixing.html"><strong aria-hidden="true">6.11.</strong> Channel Upmixing and Downmixing </a></li></ol></li><li class="chapter-item expanded "><a href="../concepts/3d_audio.html"><strong aria-hidden="true">7.</strong> 3D Audio, Panning, and HRTF</a></li><li class="chapter-item expanded "><a href="../concepts/filters_and_effects.html"><strong aria-hidden="true">8.</strong> Filters and Effects</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../concepts/filters.html"><strong aria-hidden="true">8.1.</strong> Filters</a></li><li class="chapter-item expanded "><a href="../concepts/effects.html"><strong aria-hidden="true">8.2.</strong> Effects and Effect Routing</a></li></ol></li><li class="chapter-item expanded "><a href="../concepts/events.html"><strong aria-hidden="true">9.</strong> Events</a></li><li class="chapter-item expanded "><a href="../concepts/automation.html" class="active"><strong aria-hidden="true">10.</strong> The Automation API</a></li><li class="chapter-item expanded "><a href="../concepts/stability.html"><strong aria-hidden="true">11.</strong> Stability Guarantees</a></li><li class="chapter-item expanded affix "><li class="part-title">The Object Reference</li><li class="chapter-item expanded "><a href="../object_reference/context.html"><strong aria-hidden="true">12.</strong> Context</a></li><li class="chapter-item expanded "><a href="../object_reference/buffer.html"><strong aria-hidden="true">13.</strong> Buffer</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="../object_reference/source.html"><strong aria-hidden="true">14.</strong> Operations Common to All Sources</a></li><li class="chapter-item expanded "><a href="../object_reference/direct_source.html"><strong aria-hidden="true">15.</strong> DirectSource</a></li><li class="chapter-item expanded "><a href="../object_reference/panned_sources.html"><strong aria-hidden="true">16.</strong> AngularPannedSource and ScalarPannedSource</a></li><li class="chapter-item expanded "><a href="../object_reference/source_3d.html"><strong aria-hidden="true">17.</strong> Source3D</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="../object_reference/generator.html"><strong aria-hidden="true">18.</strong> Operations Common to All Generators</a></li><li class="chapter-item expanded "><a href="../object_reference/buffer_generator.html"><strong aria-hidden="true">19.</strong> BufferGenerator</a></li><li class="chapter-item expanded "><a href="../object_reference/fast_sine_bank.html"><strong aria-hidden="true">20.</strong> FastSineBankGenerator</a></li><li class="chapter-item expanded "><a href="../object_reference/noise_generator.html"><strong aria-hidden="true">21.</strong> NoiseGenerator</a></li><li class="chapter-item expanded "><a href="../object_reference/streaming_generator.html"><strong aria-hidden="true">22.</strong> StreamingGenerator</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="../object_reference/global_effect.html"><strong aria-hidden="true">23.</strong> Operations Common to All Effects</a></li><li class="chapter-item expanded "><a href="../object_reference/global_echo.html"><strong aria-hidden="true">24.</strong> GlobalEcho</a></li><li class="chapter-item expanded "><a href="../object_reference/global_fdn_reverb.html"><strong aria-hidden="true">25.</strong> GlobalFdnReverb</a></li><li class="chapter-item expanded affix "><li class="part-title">Appendecies</li><li class="chapter-item expanded "><a href="../appendices/audio_eq_cookbook.html"><strong aria-hidden="true">26.</strong> Audio EQ Cookbook</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">The Synthizer Manual</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="the-automation-api"><a class="header" href="#the-automation-api">The Automation API</a></h1>
<p>NOTE: While the intent is that the following is stable, this is provisional and subject to change until things have had
a chance to settle.</p>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>Synthizer implements a WebAudio style automation API which can allow for the automation of double, d3, and d6
properties.  This functions through a command queue of automation events, each with a time associated.</p>
<p>In order for applications to know when automation is getting low or for other synchronization events, it is also
possible to enqueue a command which sends an event to your application.</p>
<p>The C API for this funtionality is very large.  Readers should refer to synthizer.h for function and struct prototypes.</p>
<h2 id="a-note-on-accuracy"><a class="header" href="#a-note-on-accuracy">A Note on Accuracy</a></h2>
<p>This is the first cut of the automation API.  Consequently there's a big limitation: it's not possible to perfectly
synchronize automation with the beginning of a generator/source's playback.  That is, as things stand, attempts to build
instruments and keyboards are bound to be disappointing.  Future versions of Synthizer will likely improve this case,
but the primary use for the automation API is fadeouts and crossfades, both of which can be done as things stand today.
Rather than fix this now, this API is being made available to gain experience in order to determine how we want to
address this deficiency in the future.</p>
<p>Improvement for accuracy and the ability to do instrument-level automation is being tracked
<a href="https://github.com/synthizer/synthizer/issues/78">here</a>.</p>
<h2 id="overview-of-usage"><a class="header" href="#overview-of-usage">Overview of usage</a></h2>
<p>The flow of the automation API looks like this:</p>
<ul>
<li>get the current time for an object by reading one of the following properties for that object, either from the object
itself or the context:
<ul>
<li>Using <code>SYZ_P_CURRENT_TIME</code> plus a small amount of latency, in order to let the application determine how long it
needs to get commands enqueued; or</li>
<li><code>SYZ_P_SUGGESTED_AUTOMATION_TIME</code> for Synthizer's best suggestion of when to enqueue new commands.</li>
</ul>
</li>
<li>Build an array of <code>struct syz_AutomationCommand</code>.
<ul>
<li>Set the type of command to a <code>SYZ_AUTOMATION_COMMAND_XXX</code> constant.</li>
<li>Set the time to the time of the command.</li>
<li>Set the target to the object to be automated.</li>
<li>Set the appropriate command payload in the <code>params</code> union.</li>
<li>Leave flags at 0, for now.</li>
</ul>
</li>
<li>get an automation batch with <code>syz_createAutomationBatch</code>.</li>
<li>Add commands to it with <code>syz_automationbatchAddCommands</code>.</li>
<li>Execute the batch with <code>syz_automationbatchExecute</code></li>
<li>Destroy the batch with <code>syz_handleDecRef</code></li>
</ul>
<p>The above is involved primarily because this is C: bindings can and should offer easier, builder-like interfaces that
aren't nearly so difficult.</p>
<h2 id="whats-going-on"><a class="header" href="#whats-going-on">What's going on?</a></h2>
<p>Automation allows users to build a timeline of events and property values, relative to the context's current time. These
events can then be enqueued for execution as time advances, and will happen within one &quot;block&quot; of the current
time--accurate to about 5MS.  Events can be scheduled in the past, and will contribute to any fading that's going on.</p>
<p>The best way to view this is as an approximation of a function.  That is, if an event is enqueued at time 0 to set
property x to 5, and then at time 10 to set it to 10, then at time 5 the property might be at 5 if the interpolation
type is set to linear.  The key insight is that it doesn't matter when the time 0 event was scheduled: if it was added
at time 4, the value is still 5.</p>
<p>If events are scheduled early, they happen immediately. This is in line with the intended uses of using them to know
when automation is nearing its end or is past specific times.</p>
<h2 id="time"><a class="header" href="#time">Time</a></h2>
<p>Time in Synthizer is always advancing unless the context is paused.  When the context is created, time starts at 0, then
proceeds forward.  It is possible to read the time using <code>SYZ_P_CURRENT_TIME</code>, which is available on all objects you'd
expect: generators, source, effects, etc.  By building relative to these object-local times, it is possible for
applications to be prepared for the future when this may no longer be the case, even though they all currently just
defer to the context.</p>
<p>In most cases, though, automating relative to the current time will cause commands to arrive late, and execute in the
past.  To deal with this, Synthizer offers <code>SYZ_P_SUGGESTED_AUTOMATION_TIME</code>, the time that Synthizer suggests you might
want to enqueue commands relative to for them to arrive on time.  This also advances forward, but is in the future
relative to <code>SYZ_P_CURRENT_TIME</code>.  Currently, this is a simple addition, but the goal is to make the algorithm smarter
in the future.</p>
<p><code>SYZ_P_SUGGESTED_AUTOMATION_TIME</code> is also quite latent.  It is perfectly acceptable for applications to query the
current time, then add their own smaller offset.</p>
<p>There is one typical misuse that people like to do with APIs such as this: don't re-read the current time when building
continuing timelines.  Since the current time is always advancing, this will cause your timeline to be &quot;jagged&quot;.  That
is:</p>
<pre><code>current_time = # get current time
enqueue(current_time + 5)
current_time = # get current time
enqueue(current_time + 10)
</code></pre>
<p>Will not produce events 5 seconds apart, but instead 5 seconds and a bit.  Correct usage is:</p>
<pre><code>current_time = #get current time
enqueue_command(current_time + 5)
enqueue_command(current_time + 10)
</code></pre>
<p>A good rule of thumb is that time should be read when building an automation batch, then everything for that batch done
relative to the time that was read at the beginning.</p>
<p>Finally, as implied by the above, automation doesn't respect pausing unless it's on the context: pausing a generator
with automation attached will still have automation advance even while it is paused.  This is currently unavoidable due
to internal limitations which require significant work to lift.</p>
<h2 id="automation-batches"><a class="header" href="#automation-batches">Automation Batches</a></h2>
<p>In order to enqueue commands, it is necessary to put them somewhere.  We also want an API which allows for enqueueing
more than one command at a time for efficiency.  In order to do this, Synthizer introduces the concept of the automation
batch, created with <code>syz_createAutomationBatch</code>.</p>
<p>Automation batches are one-time-use command queues, to which commands can be appended with
<code>syz_automationBatchAddCommands</code>.  Uniquely in Synthizer, they are <em>not</em> threadsafe: you must provide synchronization
yourself.  Once all the commands you want to add are added, <code>syz_automationBatchExecute</code> executes the batch. Afterwords,
due to internal limitations, the batch may not be reused.</p>
<p>Note that the intent is that batches can automate multiple objects at once.  Using a different object with every command
is perfectly fine.</p>
<h2 id="commands"><a class="header" href="#commands">Commands</a></h2>
<p>Automation offers the following command types:</p>
<ul>
<li><code>SYZ_AUTOMATION_COMMAND_APPEND_PROPERTY</code>: Add a value to the timeline for a property, e.g. &quot;use linear interpolation
to get to 20.0 by 10 seconds&quot;.</li>
<li><code>SYZ_AUTOMATION_COMMAND_SEND_USER_EVENT</code>: Add an event to the timeline, to be sent approximately when the timeline
crosses the specified time.</li>
<li><code>SYZ_AUTOMATION_COMMAND_CLEAR_PROPERTY</code>: Clear all events related to one specific property on one specific object.</li>
<li><code>SYZ_AUTOMATION_COMMAND_CLEAR_EVENTS</code>: Clear all scheduled events for an object.</li>
<li><code>SYZ_AUTOMATION_COMMAND_CLEAR_ALL_PROPERTIES</code>: Clear automation for all properties for a specific object.</li>
</ul>
<p>Commands which clear data don't respect time, and take effect immediately.  Typically, they're put at the beginning of
the automation batch in order to clean up before adding new automation.</p>
<p>Parameters to commands are specified as the enum variants of <code>syz_AutomationCommand</code>'s <code>params</code> union and are mostly
self-explanatory.  Property automation is discussed below.</p>
<h2 id="automating-property-values"><a class="header" href="#automating-property-values">Automating Property values</a></h2>
<p>Using <code>SYZ_AUTOMATION_COMMAND_APPEND_PROPERTY</code>, it is possible to append values to the timeline for a property on a
specific object.  This is done via the <code>syz_AutomationPoint</code> struct:</p>
<pre><code>struct syz_AutomationPoint {
  unsigned int interpolation_type;
  double values[6];
  unsigned long long flags;
};
</code></pre>
<p>The fields are as follows:</p>
<ul>
<li>The interpolation type specifies how to get from the last value (if any) to the current value in the point:
<ul>
<li><code>SYZ_INTERPOLATION_TYPE_NONE</code>: do nothing until the point is crossed, then jump immediately.</li>
<li><code>SYZ_P_INTERPOLATION_TYPE_LINEAR</code>: use linear interpolation from the last point.</li>
</ul>
</li>
<li>The values array specifies the values.  The number of indices used depends on the property: doubles use only the first
index, d3 use the first 3, and d6 use all 6.</li>
<li>Flags is reserved and must be 0.</li>
</ul>
<p>The timeline for a specific property represents the approximation of a continuous function, not a list of commands.  As
alluded to above, if points are early they still take effect by changing the continuous function.  This is done so that
things like audio &quot;animations&quot; can execute accurately even if the application experiences a delay.</p>
<p>Property automation interacts with normal property sets by desugaring normal property sets to
<code>SYZ_INTERPOLATION_TUYPE_NONE</code> points scheduled &quot;as soon as possible&quot;.  Users are encouraged to either use automation or
property setting rather than both at the same time, but both at the same time has a consistent behavior.</p>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<p>Events are much simpler: you specify a <code>unsigned long long</code> parameter, and get it back when the event triggers.
<code>unsigned long long</code> is used because it is possible to losslessly store a pointer in it on all platforms we support
without having to worry about the size changing on 32-bit platforms.</p>
<h2 id="examples"><a class="header" href="#examples">Examples.</a></h2>
<p>Synthizer's repository contains some examples demonstrating common automation uses in the examples directory:</p>
<ul>
<li><code>simple_automation.c</code>: build a simple envelope around a waveform.</li>
<li><code>automation_circle.c</code>: automate the position of a source to move it in circles.</li>
<li><code>play_notes.c</code>: play some notes every time the user presses enter (this works because the waveform is constant, but
isn't ideal as explained above).</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../concepts/events.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../concepts/stability.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../concepts/events.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../concepts/stability.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
