<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Handles and userdata - The Synthizer Manual</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../python.html"><strong aria-hidden="true">2.</strong> Where are the Python Bindings?</a></li><li class="chapter-item expanded affix "><li class="part-title">Concepts</li><li class="chapter-item expanded "><a href="../concepts/c_api.html"><strong aria-hidden="true">3.</strong> Introduction to the C API</a></li><li class="chapter-item expanded "><a href="../concepts/initialization.html"><strong aria-hidden="true">4.</strong> Logging, Initialization, and Shutdown</a></li><li class="chapter-item expanded "><a href="../concepts/handles.html" class="active"><strong aria-hidden="true">5.</strong> Handles and userdata</a></li><li class="chapter-item expanded "><a href="../concepts/audio_in.html"><strong aria-hidden="true">6.</strong> Basics of Audio In Synthizer</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../concepts/context.html"><strong aria-hidden="true">6.1.</strong> The Context</a></li><li class="chapter-item expanded "><a href="../concepts/generators.html"><strong aria-hidden="true">6.2.</strong> Introduction to Generators</a></li><li class="chapter-item expanded "><a href="../concepts/sources.html"><strong aria-hidden="true">6.3.</strong> Introduction to Sources</a></li><li class="chapter-item expanded "><a href="../concepts/properties.html"><strong aria-hidden="true">6.4.</strong> Controlling Object Properties</a></li><li class="chapter-item expanded "><a href="../concepts/gain.html"><strong aria-hidden="true">6.5.</strong> Setting Gain/volume</a></li><li class="chapter-item expanded "><a href="../concepts/pausing.html"><strong aria-hidden="true">6.6.</strong> Pausing and Resuming Playback</a></li><li class="chapter-item expanded "><a href="../concepts/lingering.html"><strong aria-hidden="true">6.7.</strong> Configuring Objects to Continue Playing Until Silent</a></li><li class="chapter-item expanded "><a href="../concepts/decoding.html"><strong aria-hidden="true">6.8.</strong> Streams and Decoding Audio Data</a></li><li class="chapter-item expanded "><a href="../concepts/libsndfile.html"><strong aria-hidden="true">6.9.</strong> Loading Libsndfile</a></li><li class="chapter-item expanded "><a href="../concepts/custom_streams.html"><strong aria-hidden="true">6.10.</strong> Implementing Custom Streams and Custom Stream Protocols</a></li><li class="chapter-item expanded "><a href="../concepts/channel_mixing.html"><strong aria-hidden="true">6.11.</strong> Channel Upmixing and Downmixing </a></li></ol></li><li class="chapter-item expanded "><a href="../concepts/3d_audio.html"><strong aria-hidden="true">7.</strong> 3D Audio, Panning, and HRTF</a></li><li class="chapter-item expanded "><a href="../concepts/filters_and_effects.html"><strong aria-hidden="true">8.</strong> Filters and Effects</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../concepts/filters.html"><strong aria-hidden="true">8.1.</strong> Filters</a></li><li class="chapter-item expanded "><a href="../concepts/effects.html"><strong aria-hidden="true">8.2.</strong> Effects and Effect Routing</a></li></ol></li><li class="chapter-item expanded "><a href="../concepts/events.html"><strong aria-hidden="true">9.</strong> Events</a></li><li class="chapter-item expanded "><a href="../concepts/automation.html"><strong aria-hidden="true">10.</strong> The Automation API</a></li><li class="chapter-item expanded "><a href="../concepts/stability.html"><strong aria-hidden="true">11.</strong> Stability Guarantees</a></li><li class="chapter-item expanded affix "><li class="part-title">The Object Reference</li><li class="chapter-item expanded "><a href="../object_reference/context.html"><strong aria-hidden="true">12.</strong> Context</a></li><li class="chapter-item expanded "><a href="../object_reference/buffer.html"><strong aria-hidden="true">13.</strong> Buffer</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="../object_reference/source.html"><strong aria-hidden="true">14.</strong> Operations Common to All Sources</a></li><li class="chapter-item expanded "><a href="../object_reference/direct_source.html"><strong aria-hidden="true">15.</strong> DirectSource</a></li><li class="chapter-item expanded "><a href="../object_reference/panned_sources.html"><strong aria-hidden="true">16.</strong> AngularPannedSource and ScalarPannedSource</a></li><li class="chapter-item expanded "><a href="../object_reference/source_3d.html"><strong aria-hidden="true">17.</strong> Source3D</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="../object_reference/generator.html"><strong aria-hidden="true">18.</strong> Operations Common to All Generators</a></li><li class="chapter-item expanded "><a href="../object_reference/buffer_generator.html"><strong aria-hidden="true">19.</strong> BufferGenerator</a></li><li class="chapter-item expanded "><a href="../object_reference/fast_sine_bank.html"><strong aria-hidden="true">20.</strong> FastSineBankGenerator</a></li><li class="chapter-item expanded "><a href="../object_reference/noise_generator.html"><strong aria-hidden="true">21.</strong> NoiseGenerator</a></li><li class="chapter-item expanded "><a href="../object_reference/streaming_generator.html"><strong aria-hidden="true">22.</strong> StreamingGenerator</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="../object_reference/global_effect.html"><strong aria-hidden="true">23.</strong> Operations Common to All Effects</a></li><li class="chapter-item expanded "><a href="../object_reference/global_echo.html"><strong aria-hidden="true">24.</strong> GlobalEcho</a></li><li class="chapter-item expanded "><a href="../object_reference/global_fdn_reverb.html"><strong aria-hidden="true">25.</strong> GlobalFdnReverb</a></li><li class="chapter-item expanded affix "><li class="part-title">Appendecies</li><li class="chapter-item expanded "><a href="../appendices/audio_eq_cookbook.html"><strong aria-hidden="true">26.</strong> Audio EQ Cookbook</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">The Synthizer Manual</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#handles-and-userdata" id="handles-and-userdata">Handles and userdata</a></h1>
<p>Synthizer objects are referred to via reference-counted handles, with an optional <code>void *</code> userdata pointer that can be
associated to link them to application state:</p>
<pre><code>SYZ_CAPI syz_ErrorCode syz_handleIncRef(syz_Handle handle);
SYZ_CAPI syz_ErrorCode syz_handleDecRef(syz_Handle handle);
SYZ_CAPI syz_ErrorCode syz_handleGetObjectType(int *out, syz_Handle handle);

SYZ_CAPI syz_ErrorCode syz_handleGetUserdata(void **out, syz_Handle handle);
typedef void syz_UserdataFreeCallback(void *);
SYZ_CAPI syz_ErrorCode syz_handleSetUserdata(syz_Handle handle, void *userdata, syz_UserdataFreeCallback *free_callback);
</code></pre>
<h2><a class="header" href="#basics-of-handles" id="basics-of-handles">basics of Handles</a></h2>
<p>All Synthizer handles start with a reference count of 1.  When the reference count reaches 0, the object is scheduled
for deletion, but may not be deleted immediately.  Uniquely among Synthizer functions, <code>syz_handleIncRef</code> and
<code>syz_handleDecRef</code> can be called after library shutdown in order to allow languages like Rust to implement infallible
cloning and freeing.  The issues introduced with respect to object lifetimes due to the fact that Synthizer objects may
stay around for a while can be dealt with userdata support, as described below.</p>
<p>No interface except for <code>syz_handleDecRef</code> decrements reference counts in a way which should be visible to the
application provided that the application is itself using reference counts correctly.</p>
<p>Synthizer objects are like classes.  They have &quot;methods&quot; and &quot;bases&quot;.  For example all generators support a common set
of operations named with a <code>syz_generatorXXX</code> prefix.</p>
<h3><a class="header" href="#the-reserved-config-argument" id="the-reserved-config-argument">The reserved config argument</a></h3>
<p>Many constructors take a <code>void *config</code> argument.  This must be set to NULL, and is reserved for future use.</p>
<h3><a class="header" href="#userdata" id="userdata">Userdata</a></h3>
<p>Synthizer makes it possible to associate application data via a <code>void *</code> pointer which will share the object's actual
lifetime rather than the lifetime of the handle to the object.  This is useful for allowing applications to store state,
but also helps to deal with the lifetime issues introduced by the mismatch between the last reference count of the
object dying and the object actually dying.  For example, the Rust and Python bindings use userdata to attach buffers to
objects when streaming from memory, so that the actual underlying resource stays around until Synthizer is guaranteed to
no longer use it.</p>
<p>Getting and setting userdata pointers is done in one of two ways.  All Synthizer constructors take two additional
parameters to set the userdata and the free callback.  Alternatively, an application can go through <code>syz_getUserdata</code>
and <code>syz_setUserdata</code>.  These are a threadsafe interface which will associate a <code>void *</code> argument with the object.  This
interface acts as if the operations were wrapped in a mutex internally, though they complete with no syscalls in all
reasonable cases of library usage.</p>
<p>The <code>free_callback</code> parameter to <code>syz_setUserdata</code> is optional.  If present, it will be called on the userdata pointer
when the object is destroyed or when a new userdata pointer is set.  Due to limitations of efficient audio programming,
this free happens in a background thread and may occur up to hundreds of milliseconds after the object no longer exists.</p>
<p>Most bindings will bind userdata support in a more friendly way.  For example, Python provides a <code>get_userdata</code> and
<code>set_userdata</code> pair which work on normal Python objects.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../concepts/initialization.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../concepts/audio_in.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../concepts/initialization.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../concepts/audio_in.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
